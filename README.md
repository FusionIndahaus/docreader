## Document AI

Короче, это сервис, который принимает файл + текст задачки, кидает всё в n8n, а обратно складывает ответы. Пока что без 1С, без боли, только то, что нужно.

### Что умеем
- PDF/JPG/PNG до 50 МБ — норм.
- Webhook из n8n — принимаем, парсим, складываем в память.
- UI на ванильном JS — загрузка, статус, список ответов.

### Как запустить
```bash
go run .
# открой http://localhost:8080
```

Docker:
```bash
docker build -t document-ai .
docker run -it --rm -p 8080:8080 document-ai
```

Makefile (если лень помнить команды):
```bash
make build   # go build -o document-ai .
make test    # go test ./...
make run     # собрать и стартануть
```

### Конфиг (env'ы, хардкодить не надо)
- `N8N_WEBHOOK_URL` — куда слать multipart (обязателен, иначе дефолт, но ты понял).
- `SERVER_PORT` — порт HTTP (дефолт 8080).
- `MAX_FILE_SIZE_MB` — лимит загрузки (дефолт 50).
- `MAX_RESPONSES` — сколько результатов держать в памяти (дефолт 20).
- `STATIC_DIR` — откуда отдаём фронт (дефолт `static`).

Грузится в `config.go`. Логика в `handlers.go`. Ничего лишнего.

### Архитектура (ленивая, но аккуратная)
```
main.go           # точка входа: initEnvVariables -> setupRoutes -> startServer
config.go         # читаем env'ы, выставляем глобальные настройки
types.go          # структуры: запрос/ответ/модель результата
state.go          # простая память + мьютекс (ничего rocket science)
routes.go         # регистрируем эндпоинты
handlers.go       # вся прикладная логика и утилиты (n8n, JSON, валидация)
static/           # фронтенд (css/js/html)
```

### API (минимализм)
- `POST /upload`
  - form-data: `message` (string), `file` (pdf/jpg/png)
  - ответ: `{ status: "success", message: "..." }`

- `POST /webhook`
  - сюда бьёт n8n; мы съедаем json/текст и сохраняем результат

- `GET /results`
  - список последних результатов (с лимитом по `MAX_RESPONSES`)

- `GET /health`
  - просто говорит, что всё живо

### Сборка/деплой
Локально:
```bash
go build -ldflags="-s -w" -o document-ai .
./document-ai
```

Скрипт деплоя: `deploy.sh` — собирает бинарь, кидает на сервер, рестартует сервис. Работает, если не мешать.

### CI/CD
- GitHub Actions: тесты, сборка, отчёты. Главное — собираем весь пакет, а не один файл. Уже настроено.

### Примечания
- Хотите стейт не в памяти — прикручивайте storage сами (интерфейсами инициализация не завязана, вынесете без боли).
- Логи: оставлены только предупреждения/ошибки. Если надо болтологию — добавьте уровень через env.
- n8n не отвечает — вернём ошибку. Ретраев нет, потому что не надо до тех пор, пока не надо.
